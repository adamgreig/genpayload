<!DOCTYPE html>

<!-- habitat: web template -->
<!-- http://habitat.habhub.org -->
<!-- (C) Copyright 2012; GNU GPL 3-->

<!-- Daniel Richman, Daniel Saul -->

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

    <meta charset="utf-8"/>
    <title>habitat genpayload</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

    <link rel="stylesheet" href="stylesheets/base.css"/>
    <link rel="stylesheet" href="stylesheets/skeleton.css"/>
    <link rel="stylesheet" href="stylesheets/layout.css"/>

    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="images/favicon.ico" />

    <link type="text/css" href="stylesheets/redmond/jquery-ui-1.8.21.custom.css" rel="stylesheet" />

    <script type="text/javascript" src="js/json2.js"></script>
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.couch.js"></script>
    <script type="text/javascript" src="js/timezone.js"></script>
    <script type="text/javascript" src="js/all_zones.js"></script>
    <script type="text/javascript" src="js/zone_list.js"></script>
    <script type="text/javascript" src="js/init_timezone.js"></script>
    <script type="text/javascript" src="js/genpayload.js"></script>

</head>
<body>

    <header>
        <div class="container">
            <div class="sixteen columns">
                <h1 class="no-margin"><img src="images/header_logo.jpg" alt="habitat" title="habitat"/></h1>
                <span id="app_name"><b>genpayload</b></span>
            </div>
        </div>
    </header>

    <div id="grey-section">
        <div class="container">
            <div class="two-thirds column">
                <h3 class="remove-bottom" id="page_title">Loading...</h3>
                <p class="remove-bottom" id="page_subtitle">If you can read this, the javascript isn't working :-(.</p>
            </div>
        </div>
    </div>

    <div id="sections" class="container">
        <form id="home">
            <h2>Help!</h2>

            <p>You can create two types of configuration document here:</p>

            <div class="sixteen columns no-margin">
                <h3>payload configuration documents</h3>

                <div class="eleven columns no-margin">
                    <p><code>payload_configuration</code> documents describe a payload (no prizes for guessing that).
                    They contain instructions to habitat: how to parse telemetry that listeners upload;
                    and radio settings: how to setup listeners' radios.
                    If you fly one payload multiple times, you shouldn't have to change payload configuration document.</p>
                </div>
                <div class="four columns offset-by-one no-margin">
                    <button class="remove-bottom full-width" id="go_pcfg_new">create new</button>
                    <button class="remove-bottom full-width" id="go_pcfg_modify">start from existing</button>
                </div>
            </div>

            <div class="sixteen columns no-margin">
                <h3>flight documents</h3>

                <div class="eleven columns no-margin">
                    <p><code>flight</code> documents describe the time and date of a planned flight. They allow us
                    to add the flight to the calendar, set the title on the tracker, and select only relevant
                    telemetry to go into the flight archive (i.e., exclude test data).</p>

                    <p>A flight document contains a list of payload configuration documents - i.e., the payloads
                    that are going to be launched. You can add more than one, if there are several payloads on one
                    balloon/flight train - but for multiple launches, create a flight document per balloon.</p>
                </div>
                <div class="four columns offset-by-one no-margin">
                    <button class="remove-bottom full-width" id="go_flight_new">create new</button>
                    <button class="remove-bottom full-width" id="go_flight_modify">start from existing</button>
                </div>
            </div>

            <h2>Quick start</h2>

            <p><b>I've just programmed my brand new payload, and am now testing it.</b></p>

            <p>You only need to create <a id="quick_pcfg" href='#'>a payload_configuration document</a>
            using the "new format wizard".</p>

            <p><b>I'm going to launch a balloon soon.</b></p>

            <p><a id="quick_flight" href='#'>Create a flight document</a>, then ask on IRC for the
            doc to be approved.</p>

            <p>Note that you may also create documents by copying and modifying the last document you
            created for your payload, so you need not start from scratch each time.</p>

            <h2>Extra details</h2>

            <h3>payload configuration</h3>
            <p>The sentence and radio settings in a payload configuration document are ordered lists:
            the first sentence format that matches successfully is used, and the first item in the radio
            list is the default.</p>

            <h3>Editing</h3>
            <p>You can't edit documents once they're saved. You can however load, modify and save a new
            copy of your configuration document: habitat will try the newest version first.</p>

            <h3>Launch windows</h3>
            <p>Flight documents are only valid for an amount of time, preferably as small as possible.
            Parsed strings that don't belong to an active flight document are treated as 'test' uploads,
            and will only be shown in the testing section of the new tracker.</p>

            <h3>Approval</h3>
            <p>Since anyone at all can create flight documents, they must be checked before they appear on
            the various websites. Payload configuration documents referenced by approved and active
            (within the launch window) flights are given priority when parsing.</p>

            <h3>Units</h3>
            <p>Please tell habitat how to convert all of your sensor readings into their relevant SI
            <a href="http://en.wikipedia.org/wiki/SI_base_unit">base</a> or
            <a href="http://en.wikipedia.org/wiki/SI_derived_unit">derived</a> unit
            without a metric prefix
            (except: use <span title="an accepted SI unit for temperature interval">Celsius</span> for temperature;
            <span title="an accepted unit">degrees</span> for latitude, longitude, heading;
            <span title="because physicists are hilarious">kilograms</span> for mass).
            For example: Volts for battery readings,
            <span title="the tracker may change the prefix to display pressure (and similar cases)">Pa (not kPa)</span>
            for pressure, m/s for speed. You can scale your fields with habitat, your payload need not do
            the conversion.</p>

            <h2>See also</h2>
            <ul>
                <li><a href="http://habitat.habhub.org/">habitat</a></li>
                <li><a href="http://habitat.habhub.org/logtail/">Live parser log output for debugging</a></li>
                <li><a href="http://habhub.org">habhub</a></li>
            </ul>
        </form>

        <form id="browse">
            <div class="sixteen columns remove-bottom">
                <label class="two columns alpha" for="browse_search">Search text: </label>
                <div class="six columns">
                    <input type="text" id="browse_search" />
                </div>

                <button class="two columns" id="browse_search_go">Search</button>
                <button class="two columns" id="browse_prev">Prev Page</button>
                <button class="two columns" id="browse_next">Next Page</button>
                <button class="two columns omega" id="browse_cancel">Cancel</button>
            </div>

            <div class="sixteen columns" id="browse_status"></div>

            <h3> todo: style rows of table </h3>

            <table class="sixteen columns" id="browse_list_table"><tbody id="browse_list"></tbody></table>
        </form>

        <form id="payload_configuration">
            <div id="pcfg_misc" class="sixteen columns">
                <div class="row">
                    <label class="two columns alpha" for="pcfg_name">Payload name</label>
                    <div class="six columns">
                        <input type="text" id="pcfg_name" />
                        <img src="images/tick.png" alt="Complete" class="input_validicon" />
                    </div>
                    <div class="six columns offset-by-two omega">
                        <div class="input_extra">need not be its callsign</div>
                    </div>
                </div>
                <div class="row">
                    <label class="two columns alpha" for="pcfg_description">Description</label>
                    <div class="eight columns">
                        <input type="text" id="pcfg_description" class="long" />
                        <img src="images/tick.png" alt="Complete" class="input_validicon" />
                    </div>
                    <div class="six columns omega">
                        <div class="input_extra">
                            free form, optional <br />
                            used only to help you find it later
                        </div>
                    </div>
                </div>
            </div>

            <hr />

            <div class="sixteen columns">
                <h5 class="add-bottom">Radio and telemetry configuration</h3>

                <table><tbody id="transmissions_list"></tbody></table>

                <div class="buttons">
                    <button id="transmission_new">Add</button>
                </div>
            </div>

            <hr />

            <div class="sixteen columns">
                <h5 class="add-bottom">Parser configuration</h3>

                <table><tbody id="sentences_list"></tbody></table>

                <div class="buttons">
                    <button id="go_wizard">New format wizard</button>
                    <button id="go_manual">Manually add a new format</button>
                    <button id="go_import">Copy format from another doc</button>
                </div>
            </div>

            <hr />

            <div class="sixteen columns buttons">
                <button id="pcfg_save">Save</button>
                <button id="pcfg_abandon">Cancel</button>
            </div>
        </form>

        <form id="transmission_edit" class="separate_children">
            <div id="transmission_misc" class="sixteen columns">
                <div>
                    <label for="transmission_description">Description</label>
                    <input type="text" id="transmission_description" class="long_input" />
                    <span class="input_extra">(optional; e.g., Primary, alternative, nighttime mode)</span>
                </div>
                <div>
                    <label for="transmission_frequency">Frequency (MHz)</label>
                    <input type="text" id="transmission_frequency" class="short_input" />
                    <span class="input_extra">(MHz)</span>
                </div>
                <div>
                    <label for="transmission_mode">Mode</label>
                    <select id="transmission_mode">
                        <option>USB</option>
                        <option>LSB</option>
                        <option>AM</option>
                        <option>FM</option>
                    </select>
                </div>
                <div>
                    <label for="transmission_modulation">Modulation</label>
                    <select id="transmission_modulation">
                        <option>RTTY</option>
                        <option>DominoEX</option>
                        <option>Hellschreiber</option>
                    </select>
                </div>
            </div>

            <div id="transmission_rtty" class="sixteen columns">
                <div>
                    <label for="transmission_shift">Shift (Hz)</label>
                    <input type="text" id="transmission_shift" class="short_input" />
                </div>
                <div>
                    <label for="transmission_encoding">Encoding</label>
                    <select id="transmission_encoding">
                        <option>BAUDOT</option>
                        <option>ASCII-7</option>
                        <option>ASCII-8</option>
                    </select>
                </div>
                <div>
                    <label for="transmission_baud">Baud</label>
                    <input type="text" id="transmission_baud" class="short_input" />
                </div>
                <div>
                    <label for="transmission_parity">Parity</label>
                    <select id="transmission_parity">
                        <option>none</option>
                        <option>odd</option>
                        <option>even</option>
                    </select>
                </div>
                <div>
                    <label for="transmission_stop">Stop bits</label>
                    <select id="transmission_stop">
                        <option>1</option>
                        <option>1.5</option>
                        <option>2</option>
                    </select>
                </div>
            </div>

            <div id="transmission_dominoex" class="sixteen columns">
                <div>
                    <label for="transmission_speed">Speed</label>
                    <select id="transmission_speed">
                        <option>4</option>
                        <option>5</option>
                        <option>8</option>
                        <option>11</option>
                        <option>16</option>
                        <option>22</option>
                    </select>
                </div>
            </div>

            <div id="transmission_hellschreiber" class="sixteen columns">
                <div>
                    <label for="transmission_variant">Variant</label>
                    <select id="transmission_variant">
                        <option value="slowhell">Slow Hell</option>
                        <option value="feldhell">Feld Hell</option>
                    </select>
                </div>
            </div>


            <hr />

            <div class="buttons">
                <button id="transmission_confirm">Confirm</button>
                <button id="transmission_cancel">Cancel</button>
            </div>
        </form>

        <form id="sentence_wizard">
            <input type="text" id="wizard_text_box" placeholder="Please paste an example typical telemetry string" />

            <div class="small" id="wizard_error"></div>

            <div id="wizard_success">
                <div id="wizard_fields"></div>
                <div class="small" id="wizard_parse_info">
                    Parse OK; callsign: <span id="wizard_callsign"></span>,
                    checksum: <span id="wizard_checksum_type"></span>
                </div>

                <hr />
            </div>

            <div id="wizard_form">
                <div class="sixteen columns">
                    <div>
                        <label for="wizard_field_name">Field name</label>
                        <input type="text" id="wizard_field_name" />
                    </div>
                    <div>
                        <label for="wizard_field_sensor">Field type</label>
                        <select id="wizard_field_sensor"></select>
                    </div>
                    <div id="wizard_coordinate_format">
                        <label for="wizard_coordinate_format_select">Format</label>
                        <select id="wizard_coordinate_format_select"></select>
                    </div>
                </div>
                <div id="wizard_numeric_scale_section">
                    <div>
                        <input type="checkbox" id="wizard_numeric_scale" />
                        <label for="wizard_numeric_scale">Scale or translate this value</label>
                    </div>
                    <div id="wizard_numeric_scale_opts">
                        <div>
                            <select id="wizard_numeric_scale_type">
                                <option value="m">Multiply</option>
                                <option value="d">Divide</option>
                            </select>
                            <label for="wizard_numeric_scale_factor">by</label>
                            <input type="text" id="wizard_numeric_scale_factor" class="short_input" />
                        </div>
                        <div>
                            <label for="wizard_numeric_scale_offset">Offset:</label>
                            <input type="text" id="wizard_numeric_scale_offset" class="short_input" />
                        </div>
                        <div>
                            <label for="wizard_numeric_scale_do_round">Round?</label>
                            <input type="checkbox" id="wizard_numeric_scale_do_round" />

                            <span id="wizard_numeric_scale_round_opts">
                                To <input type="text" id="wizard_numeric_scale_round" class="short_input" />
                                <label for="wizard_numeric_scale_round">significant figures.</label>
                            </span>
                        </div>
                        <div id="wizard_numeric_scale_example_container">
                            Example result: <span id="wizard_numeric_scale_example"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="wizard_misc" class="separate_children">
                <div>
                    <label for="wizard_description">Format name or description</label>
                    <input type="text" id="wizard_description" class="long_input" />
                    <span class="input_extra">(optional but strongly recommended; e.g., Normal format, No-lock
                    format (if it's different), Long format (i.e., more fields), and so on.</span>
                </div>
                <div>
                    <label for="wizard_no_lock">When it doesn't have a lock, the payload sends</label>
                    <select id="wizard_no_lock">
                        <option value="other">other</option>
                        <option value="always">this format</option>
                        <option value="lockfield">a certain value in a gps lock field</option>
                        <option value="zeroes">latitude/longitude as 0,0</option>
                    </select>
                </div>

                <div id="wizard_nolock_othernotice">
                    <p class="small">Other: Includes sending another format, such as empty or "!!!.!!!!!" fields.
                    You should add the 'no-lock' format as another sentence format after you have finished this one.</p>
                </div>

                <div id="wizard_nolock_alwaysnotice">
                    <p class="small">Any latitude longitude or altitude, if present, will be marked invalid.
                    Other parsed data, like temperature, can still be used and plotted.</p>
                </div>

                <div id="wizard_select_lockfield">
                    <p>Please click on the field to test above</p>
                </div>

                <div id="wizard_lockfield">
                    <label>The following values in the <span id="wizard_lockfield_which"></span>
                    field are ok/indicate a lock:</label>

                    <div id="wizard_lockfield_ok">
                    </div>

                    <div class="buttons">
                        <button id="wizard_lockfield_add">Add</button>
                        <button id="wizard_lockfield_remove">Remove</button>
                    </div>
                </div>
            </div>

            <hr />

            <div id="wizard_buttons" class="buttons">
                <button id="wizard_next">Next</button>
                <button id="wizard_prev">Prev</button>
                <button id="wizard_cancel">Cancel</button>
            </div>
        </form>

        <form id="sentence_edit">
            <div id="sentence_misc" class="sixteen columns">
                <div>
                    <label for="sentence_description">Name or description</label>
                    <input type="text" id="sentence_description" class="long_input" />
                    <span class="input_extra">(optional but strongly recommended; e.g., Normal format, No-lock
                    format (if it's different), Long format (i.e., more fields), and so on.</span>
                </div>
                <div>
                    <label for="sentence_protocol">Protocol</label>
                    <input type="text" id="sentence_protocol" value="UKHAS" disabled="disabled" />
                </div>
                <div>
                    <label for="sentence_callsign">Callsign</label>
                    <input type="text" id="sentence_callsign" />
                </div>
                <div>
                    <label for="sentence_checksum">Checksum type</label>
                    <select id="sentence_checksum">
                        <option>crc16-ccitt</option>
                        <option>xor</option>
                        <option>fletcher-16</option>
                        <option>fletcher-16-256</option>
                    </select>
                </div>
            </div>

            <hr />

            <div>
                <h3>fields</h3>

                <div id="sentence_fields" class="sentence_list"></div>

                <div class="buttons">
                    <button id="sentence_fields_add">Add Normal Field</button>
                    <button id="sentence_fields_expert">Add Custom Field</button>
                </div>
            </div>

            <hr />

            <div>
                <h3>intermediate filters</h3>

                <div id="sentence_intermediate_filters" class="sentence_list"></div>

                <div class="buttons">
                    <button id="sentence_intermediate_normal_filter_add">Add filter</button>
                    <button id="sentence_intermediate_hotfix_filter_add">Add hotfix</button>
                </div>

                <h3>post parse filters</h3>

                <div id="sentence_post_filters" class="sentence_list"></div>

                <div class="buttons">
                    <button id="sentence_post_normal_filter_add">Add filter</button>
                    <button id="sentence_post_hotfix_filter_add">Add hotfix</button>
                </div>
            </div>

            <hr />

            <div class="buttons">
                <button id="sentence_edit_save">Save</button>
                <button id="sentence_edit_cancel">Cancel</button>
            </div>
        </form>

        <form id="loading_docs">
            <p id="loading_docs_text"></p>

            <div class="buttons">
                <button id="loading_docs_back">Back</button>
            </div>
        </form>

        <form id="flight">
            <h2>flight</h2>

            <hr />

            <div class="sixteen columns">
                <div>
                    <label for="flight_name">Flight name</label>
                    <input type="text" id="flight_name" />
                    <span class="input_extra">e.g., Dalmation launch 32 or Shark Christmas launch.</span>
                </div>
                <div>
                    <label for="flight_project">Project name</label>
                    <input type="text" id="flight_project" />
                    <span class="input_extra">Optional, but highly recommended.</span>
                </div>
                <div>
                    <label for="flight_group">Group/team/organisation name</label>
                    <input type="text" id="flight_group" />
                    <span class="input_extra">Or your name, if you're working alone :-(. Optional, also recommended.</span>
                </div>
            </div>

            <hr />

            <div id="dates" class="sixteen columns">
                <div id="launch_timezone_section">
                    <label for="launch_timezone">Timezone</label>
                    <input type="text" id="launch_timezone" />
                    <span class="input_extra">Launch time below is interpreted in this timezone; daylight saving detected automatically from the date. <br />
                    Some clients/trackers may display times related to this flight in this timezone rather than the user's.</span>
                </div>
                <div>
                    <label for="launch_date">Launch Date</label>
                    <div id="launch_date"></div>
                </div>
                <div>
                    <label for="launch_time">Time</label>
                    <input type="text" id="launch_time" placeholder="HH:MM" />
                    <span class="input_extra" id="launch_time_check"></span>
                </div>
                <div>
                    <label for="launch_window">Launch window</label>
                    <select id="launch_window">
                        <option value="day">Launch day</option>
                        <option value="three">3 days surrounding</option>
                        <option value="other">other</option>
                    </select>
                    <div id="launch_window_start"></div>
                    <div id="launch_window_end"></div>
                    <span class="input_extra">This period must cover the entire flight, and ideally exclude testing, so that only telemetry from the flight itself is archived. <br />
                    <span id="launch_window_info"></span></span>
                </div>
            </div>

            <hr />

            <div class="sixteen columns">
                <div>
                    <label for="launch_location_name">Launch location name</label>
                    <input type="text" id="launch_location_name" class="long_input" />
                    <span class="input_extra">Optional. Suggested format: Place name, Area, Country</span>
                </div>
                <div>
                    <label for="launch_latitude">Launch latitude (decimal degrees)</label>
                    <input type="text" id="launch_latitude" />
                </div>
                <div>
                    <label for="launch_longitude">Launch longitude (decimal degrees)</label>
                    <input type="text" id="launch_longitude" />
                    <span class="input_extra">-180 &lt; l &lt;= 180</span>
                </div>
                <div>
                    <label for="launch_altitude">Launch altitude (metres)</label>
                    <input type="text" id="launch_altitude" />
                    <span class="input_extra">Optional: only enter it if it's significant.</span>
                </div>
            </div>

            <hr />

            <div id="flight_pcfgs">
                <h3>payloads in this flight</h3>

                <table id="flight_pcfgs_list_table">
                    <tbody id="flight_pcfgs_list"></tbody>
                </table>

                <div class="buttons">
                    <button id="flight_pcfgs_add">Add</button>
                </div>
            </div>

            <hr />

            <div class="buttons">
                <button id="flight_save">Save</button>
                <button id="flight_abandon">Cancel</button>
            </div>
        </form>

        <form id="saving">
            <h2 id="saving_status">Saving...</h2>

            <p>Document: <input type='text' id='saving_doc' class='long_input' disabled='disabled' /></p>

            <div id="save_success">
                <p>Doc ID: <span id='saved_id' /></p>

                <div class="buttons">
                    <button id='save_done'>Done</button>
                </div>
            </div>

            <div id="save_fail">
                <p>Error: <span id='save_fail_message' /></p>
                <div class='buttons'>
                    <button id='save_retry'>Retry</button>
                    <button id='save_back'>Back</button>
                </div>
            </div>
        </form>

    </div>

</body>
</html>
